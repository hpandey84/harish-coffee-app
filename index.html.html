<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coffee Shop — Live Orders Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Small visual tweaks */
    body { background: #f8fafc; }
    .card-shadow { box-shadow: 0 6px 18px rgba(15,23,42,0.06); }
    .pulse-alert { animation: pulse 1.6s infinite; }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(220,38,38,0.25);} 70% { box-shadow: 0 0 0 8px rgba(220,38,38,0);} 100% { box-shadow: 0 0 0 0 rgba(220,38,38,0);} }
  </style>
</head>
<body class="antialiased text-slate-800">
  <div class="max-w-7xl mx-auto p-4 md:p-6">
    <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold">☕ Coffee Shop — Live Orders</h1>
        <p class="text-sm text-slate-500">Manager dashboard · responsive · single-file</p>
      </div>
      <div class="flex items-center gap-3">
        <label class="text-sm text-slate-600">Auto-refresh:</label>
        <select id="autoRefreshSelect" class="rounded border px-2 py-1 text-sm">
          <option value="0">Off</option>
          <option value="5">5s</option>
          <option value="10">10s</option>
          <option value="30">30s</option>
          <option value="60">60s</option>
        </select>
        <button id="addDemoBtn" class="bg-emerald-500 hover:bg-emerald-600 text-white rounded px-3 py-1 text-sm">Add demo order</button>
        <button id="addMultipleBtn" class="bg-emerald-100 hover:bg-emerald-200 text-emerald-800 rounded px-3 py-1 text-sm">+5 demo</button>
      </div>
    </header>

    <!-- Summary bar -->
    <section id="summaryBar" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-white p-4 rounded-2xl card-shadow">
        <div class="text-xs text-slate-500">Total orders (today)</div>
        <div id="totalOrders" class="text-2xl font-semibold">0</div>
      </div>
      <div class="bg-white p-4 rounded-2xl card-shadow">
        <div class="text-xs text-slate-500">Pending (waiting + in progress)</div>
        <div id="pendingCount" class="text-2xl font-semibold">0</div>
      </div>
      <div class="bg-white p-4 rounded-2xl card-shadow">
        <div class="text-xs text-slate-500">Ready</div>
        <div id="readyCount" class="text-2xl font-semibold">0</div>
      </div>
      <div class="bg-white p-4 rounded-2xl card-shadow">
        <div class="text-xs text-slate-500">Total revenue (today)</div>
        <div id="totalRevenue" class="text-2xl font-semibold">$0.00</div>
      </div>
    </section>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Orders grid -->
      <section class="lg:col-span-2">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-lg font-semibold">Active Orders</h2>
          <div class="text-sm text-slate-500">Showing live simulated orders</div>
        </div>
        <div id="ordersGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
      </section>

      <!-- Right column: Alerts + Assistant -->
      <aside class="space-y-4">
        <div class="bg-white p-4 rounded-2xl card-shadow">
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold">Alerts</h3>
            <button id="clearAlerts" class="text-xs text-slate-500 hover:text-slate-700">Clear</button>
          </div>
          <div id="alertsPanel" class="text-sm text-slate-700 space-y-2 min-h-[120px]"></div>
        </div>

        <div class="bg-white p-4 rounded-2xl card-shadow">
          <div class="flex items-center justify-between mb-2">
            <h3 class="font-semibold">Smart Assistant</h3>
            <button id="runAssistant" class="text-xs text-slate-500 hover:text-slate-700">Run</button>
          </div>
          <div id="assistantPanel" class="text-sm text-slate-700 space-y-2 min-h-[120px]"></div>
        </div>

        <div class="bg-white p-4 rounded-2xl card-shadow">
          <h3 class="font-semibold mb-2">Controls & Filters</h3>
          <div class="flex flex-col gap-2 text-sm">
            <label class="flex items-center gap-2"><input id="showCancelled" type="checkbox" class="form-checkbox"> Show cancelled orders</label>
            <label class="flex items-center gap-2"><input id="showReady" type="checkbox" checked class="form-checkbox"> Show ready orders</label>
            <label class="flex items-center gap-2"><input id="groupByPayment" type="checkbox" class="form-checkbox"> Group by payment method (UI hint)</label>
          </div>
        </div>

      </aside>
    </main>

    <footer class="mt-6 text-xs text-slate-500">Tip: use the auto-refresh to simulate live progress. This demo is single-file and client-side only.</footer>
  </div>


  <script>
  // -------------------- Data & Demo Items --------------------
  const ITEMS = [
    {name: 'Latte', price: 4.5}, {name: 'Espresso', price: 3.0}, {name: 'Cappuccino', price:4.0},
    {name: 'Americano', price:3.0}, {name: 'Mocha', price:4.8}, {name: 'Flat White', price:4.2},
    {name: 'Croissant', price:2.8}, {name: 'Chocolate Croissant', price:3.2}, {name: 'Blueberry Muffin', price:2.5},
    {name: 'Bagel', price:2.0}, {name: 'Cookie', price:1.8}, {name: 'Sandwich', price:5.5}
  ];
  const PAYMENT_METHODS = ['Card','Cash','Mobile Pay'];

  // Order statuses: waiting / in_progress / ready / cancelled
  let orders = [];
  let autoInterval = null;

  // Today's date reference (for revenue grouping; in demo we'll assume all orders are today)
  const today = new Date();

  // -------------------- Helpers --------------------
  function uid() { return Math.random().toString(36).slice(2,9); }
  function nowISO() { return new Date().toISOString(); }
  function formatTime(iso) {
    const d = new Date(iso);
    return d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
  }
  function minutesSince(iso) {
    return Math.floor((Date.now() - new Date(iso)) / 60000);
  }
  function money(v){ return '$' + v.toFixed(2); }

  // -------------------- Order Generation --------------------
  function generateRandomOrder() {
    const numItems = Math.floor(Math.random()*5) + 1; // 1-5
    const items = [];
    let total = 0;
    for(let i=0;i<numItems;i++){
      const it = ITEMS[Math.floor(Math.random()*ITEMS.length)];
      items.push({name: it.name, price: it.price});
      total += it.price;
    }
    const order = {
      id: uid(),
      customer: sampleCustomerName(),
      items,
      status: 'waiting',
      payment: PAYMENT_METHODS[Math.floor(Math.random()*PAYMENT_METHODS.length)],
      createdAt: nowISO(),
      total: parseFloat(total.toFixed(2)),
      cancelled: false
    };
    return order;
  }

  const NAMES = ['Asha','Ravi','Maya','Sam','Priya','Noah','Liam','Zara','Isha','Arjun','Karan','Luo','Jin','Ana','Diego'];
  function sampleCustomerName(){
    const n = NAMES[Math.floor(Math.random()*NAMES.length)];
    if(Math.random() < 0.15) return n + ' (Group)';
    return n;
  }

  // -------------------- Rendering --------------------
  function renderOrders() {
    const grid = document.getElementById('ordersGrid');
    grid.innerHTML = '';
    const showCancelled = document.getElementById('showCancelled').checked;
    const showReady = document.getElementById('showReady').checked;

    const filtered = orders.filter(o => {
      if(o.cancelled && !showCancelled) return false;
      if(o.status === 'ready' && !showReady) return false;
      return true;
    });

    if(filtered.length === 0) {
      grid.innerHTML = '<div class="col-span-full bg-white p-6 rounded-2xl card-shadow text-slate-500">No orders to show — add demo orders to begin.</div>';
      return;
    }

    filtered.forEach(order => {
      const card = document.createElement('div');
      card.className = 'bg-white p-4 rounded-2xl card-shadow relative';
      if(order.cancelled) card.classList.add('opacity-60');

      // header
      const header = document.createElement('div');
      header.className = 'flex items-start justify-between gap-2 mb-2';
      header.innerHTML = `
        <div>
          <div class="font-semibold">${escapeHtml(order.customer)}</div>
          <div class="text-xs text-slate-400">${formatTime(order.createdAt)} • ${order.payment}</div>
        </div>
        <div class="text-sm font-mono text-slate-600">${money(order.total)}</div>
      `;
      card.appendChild(header);

      // items list
      const itemList = document.createElement('div');
      itemList.className = 'text-sm text-slate-700 mb-3';
      order.items.forEach(it => {
        const el = document.createElement('div');
        el.className = 'flex items-center justify-between';
        el.innerHTML = `<div>${escapeHtml(it.name)}</div><div class="text-xs text-slate-500">${money(it.price)}</div>`;
        itemList.appendChild(el);
      });
      card.appendChild(itemList);

      // status badge & controls
      const controls = document.createElement('div');
      controls.className = 'flex items-center justify-between gap-3';

      const statusBadge = document.createElement('div');
      statusBadge.className = 'inline-flex items-center gap-2 text-xs font-semibold px-2 py-1 rounded-full';
      statusBadge.textContent = statusText(order.status, order.cancelled);
      if(order.cancelled) statusBadge.className += ' bg-red-100 text-red-700';
      else if(order.status === 'waiting') statusBadge.className += ' bg-yellow-100 text-yellow-800';
      else if(order.status === 'in_progress') statusBadge.className += ' bg-sky-100 text-sky-800';
      else if(order.status === 'ready') statusBadge.className += ' bg-emerald-100 text-emerald-800';

      // long-wait flag
      const waitMins = minutesSince(order.createdAt);
      if(!order.cancelled && order.status !== 'ready' && waitMins >= 10) {
        statusBadge.className += ' pulse-alert';
        statusBadge.title = 'Long waiting order';
      }

      controls.appendChild(statusBadge);

      const btnGroup = document.createElement('div');
      btnGroup.className = 'flex gap-2';

      const advanceBtn = document.createElement('button');
      advanceBtn.className = 'text-xs px-2 py-1 rounded border';
      advanceBtn.textContent = 'Advance';
      advanceBtn.onclick = () => { advanceStatus(order.id); };

      const cancelBtn = document.createElement('button');
      cancelBtn.className = 'text-xs px-2 py-1 rounded border text-red-600';
      cancelBtn.textContent = 'Cancel';
      cancelBtn.onclick = () => { cancelOrder(order.id); };

      btnGroup.appendChild(advanceBtn);
      btnGroup.appendChild(cancelBtn);
      controls.appendChild(btnGroup);

      card.appendChild(controls);

      // footer: small meta
      const footer = document.createElement('div');
      footer.className = 'mt-3 text-xs text-slate-400 flex items-center justify-between';
      footer.innerHTML = `
        <div>${order.items.length} items</div>
        <div>${waitMins} min ago</div>
      `;
      card.appendChild(footer);

      // Attach to grid
      grid.appendChild(card);
    });
  }

  function statusText(status, cancelled) {
    if(cancelled) return 'Cancelled';
    if(status === 'waiting') return 'Waiting';
    if(status === 'in_progress') return 'In progress';
    if(status === 'ready') return 'Ready';
    return status;
  }

  function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  // -------------------- Order Actions --------------------
  function advanceStatus(id) {
    const o = orders.find(x => x.id === id); if(!o) return;
    if(o.cancelled) return;
    if(o.status === 'waiting') o.status = 'in_progress';
    else if(o.status === 'in_progress') o.status = 'ready';
    renderAll();
  }
  function cancelOrder(id) {
    const o = orders.find(x => x.id === id); if(!o) return;
    o.cancelled = true; o.status = 'cancelled';
    renderAll();
  }

  // -------------------- Alerts & Assistant --------------------
  function computeAlerts() {
    const alerts = [];
    orders.forEach(o => {
      const mins = minutesSince(o.createdAt);
      if(!o.cancelled && o.status !== 'ready' && mins >= 10) alerts.push({type:'Long wait', order:o, text:`Order ${o.id} waiting ${mins} min`});
      if(!o.cancelled && o.items.length >= 6) alerts.push({type:'Large group', order:o, text:`Large group order ${o.id} (${o.items.length} items)`});
      if(o.cancelled) alerts.push({type:'Cancelled', order:o, text:`Order ${o.id} was cancelled`});
    });
    return alerts;
  }

  function renderAlerts() {
    const panel = document.getElementById('alertsPanel');
    const alerts = computeAlerts();
    if(alerts.length === 0) { panel.innerHTML = '<div class="text-slate-400">No alerts — all clear.</div>'; return; }
    panel.innerHTML = '';
    alerts.forEach(a => {
      const el = document.createElement('div');
      el.className = 'flex items-start gap-2';
      el.innerHTML = `<div class="w-2 h-2 rounded-full mt-1 ${a.type==='Cancelled' ? 'bg-red-500' : a.type==='Long wait' ? 'bg-yellow-400' : 'bg-sky-400'}"></div><div><div class="font-semibold text-sm">${escapeHtml(a.type)}</div><div class="text-xs text-slate-600">${escapeHtml(a.text)}</div></div>`;
      panel.appendChild(el);
    });
  }

  function runAssistant() {
    const panel = document.getElementById('assistantPanel');
    const suggestions = [];

    // Suggest prepping based on item counts in queue (waiting + in_progress)
    const pending = orders.filter(o => !o.cancelled && o.status !== 'ready');
    const counts = {};
    pending.forEach(o => o.items.forEach(it => counts[it.name] = (counts[it.name]||0) + 1));

    // Top items
    const entries = Object.entries(counts).sort((a,b)=>b[1]-a[1]);
    if(entries.length) {
      const [topItem, topCount] = entries[0];
      if(topCount >= 4) suggestions.push(`Consider prepping more ${topItem} — ${topCount} orders in queue.`);
    }

    // If many pending orders
    if(pending.length >= 6) suggestions.push(`High queue length: ${pending.length} pending orders. Consider calling another barista.`);

    // Cancelled ratio
    const cancelledCount = orders.filter(o=>o.cancelled).length;
    if(cancelledCount >= 3) suggestions.push(`There have been ${cancelledCount} cancellations today — check order flow or clarify menu/options.`);

    // Long wait warning
    const longWaits = computeAlerts().filter(a=>a.type==='Long wait');
    if(longWaits.length) suggestions.push(`There are ${longWaits.length} long-waiting orders (>=10 min). Prioritize them.`);

    // If nothing
    if(suggestions.length === 0) suggestions.push('All looks smooth — no urgent suggestions at the moment.');

    // Render
    panel.innerHTML = '';
    suggestions.forEach(s => {
      const el = document.createElement('div');
      el.className = 'text-sm text-slate-700 p-2 rounded';
      el.textContent = s;
      panel.appendChild(el);
    });
  }

  // -------------------- Summary --------------------
  function updateSummary() {
    const total = orders.length;
    const ready = orders.filter(o=>o.status==='ready' && !o.cancelled).length;
    const pending = orders.filter(o=>!o.cancelled && o.status!=='ready').length;
    const revenue = orders.filter(o=>!o.cancelled).reduce((s,o)=>s+o.total,0);

    document.getElementById('totalOrders').textContent = total;
    document.getElementById('readyCount').textContent = ready;
    document.getElementById('pendingCount').textContent = pending;
    document.getElementById('totalRevenue').textContent = money(revenue);
  }

  // -------------------- Auto-refresh Simulation --------------------
  function setAutoRefresh(sec) {
    if(autoInterval) clearInterval(autoInterval);
    autoInterval = null;
    if(sec <= 0) return;
    autoInterval = setInterval(()=>{
      // Simulate progress: randomly promote some waiting -> in_progress, some in_progress -> ready
      // Also randomly add a demo order occasionally
      const waiting = orders.filter(o=>o.status==='waiting' && !o.cancelled);
      const inprogress = orders.filter(o=>o.status==='in_progress' && !o.cancelled);

      if(waiting.length && Math.random() < 0.6) {
        const pick = waiting[Math.floor(Math.random()*waiting.length)];
        pick.status = 'in_progress';
      }
      if(inprogress.length && Math.random() < 0.5) {
        const pick = inprogress[Math.floor(Math.random()*inprogress.length)];
        pick.status = 'ready';
      }
      if(Math.random() < 0.2) orders.push(generateRandomOrder());
      renderAll();
    }, sec*1000);
  }

  // -------------------- Utilities --------------------
  function renderAll(){ renderOrders(); updateSummary(); renderAlerts(); }

  // -------------------- UI wiring --------------------
  document.getElementById('addDemoBtn').addEventListener('click', ()=>{ orders.push(generateRandomOrder()); renderAll(); });
  document.getElementById('addMultipleBtn').addEventListener('click', ()=>{ for(let i=0;i<5;i++) orders.push(generateRandomOrder()); renderAll(); });
  document.getElementById('clearAlerts').addEventListener('click', ()=>{ /* In demo just clear by acknowledging: we won't remove orders */ const panel = document.getElementById('alertsPanel'); panel.innerHTML = '<div class="text-slate-400">Alerts acknowledged.</div>'; });
  document.getElementById('runAssistant').addEventListener('click', runAssistant);
  document.getElementById('showCancelled').addEventListener('change', renderAll);
  document.getElementById('showReady').addEventListener('change', renderAll);
  document.getElementById('groupByPayment').addEventListener('change', (e)=>{ /* UI hint only in this demo */ alert('Grouping by payment method is a UI hint in this demo.'); });

  document.getElementById('autoRefreshSelect').addEventListener('change', (e)=>{
    const val = Number(e.target.value);
    setAutoRefresh(val);
  });

  // -------------------- Initial demo data --------------------
  for(let i=0;i<6;i++) orders.push(generateRandomOrder());

  // Add a deliberately long-wait order for alert demo
  const long = generateRandomOrder(); long.createdAt = new Date(Date.now() - 11*60000).toISOString(); orders.push(long);
  // add a large group
  const big = generateRandomOrder(); big.items = Array.from({length:7}, ()=>ITEMS[Math.floor(Math.random()*ITEMS.length)] ); big.total = big.items.reduce((s,it)=>s+it.price,0); orders.push(big);

  // initial render
  renderAll();
  runAssistant();

  // -------------------- Small extra helpers --------------------
  // Allow advancing/cancelling via external calls used in demo renders
  window.advanceStatus = function(id){ advanceStatus(id); }
  window.cancelOrder = function(id){ cancelOrder(id); }

  </script>
</body>
</html>
